# Architecture

```
                        CONDUCTOR
                 (worktrees + Claude Code)
                            │
        ┌───────────────────┼───────────────────┐
        ▼                   ▼                   ▼
   ┌─────────┐         ┌─────────┐         ┌─────────┐
   │ ws: foo │         │ ws: bar │         │ ws: baz │
   └────┬────┘         └────┬────┘         └────┬────┘
        │                   │                   │
        └───────────────────┼───────────────────┘
                            ▼
                          MONO
                            │
        ┌───────────────────┼───────────────────┐
        ▼                   ▼                   ▼
   ┌─────────┐         ┌─────────┐         ┌─────────┐
   │ mono-foo│         │ mono-bar│         │ mono-baz│
   │ :19100  │         │ :19200  │         │ :19300  │
   └────┬────┘         └────┬────┘         └────┬────┘
        │                   │                   │
        └───────────────────┼───────────────────┘
                            │
              ┌─────────────┴─────────────┐
              ▼                           ▼
    ┌──────────────────┐       ┌──────────────────┐
    │  ~/.mono/cache_  │       │  ~/.mono/cache_  │
    │     global/      │       │      local/      │
    │  ┌────────────┐  │       │  ┌────────────┐  │
    │  │  sccache/  │  │       │  │ {projectID}│  │
    │  │   (rust    │  │       │  │  ├─cargo/  │  │
    │  │  compiler) │  │       │  │  ├─npm/    │  │
    │  └────────────┘  │       │  │  └─yarn/   │  │
    └──────────────────┘       └──────────────────┘
              │                           │
              └───────────┬───────────────┘
                          ▼
                 ┌────────────────┐
                 │   state.db     │
                 │ ┌────────────┐ │
                 │ │cache_events│ │
                 │ │ hits/misses│ │
                 │ │ last_used  │ │
                 │ └────────────┘ │
                 └────────────────┘
```

Each workspace gets isolated ports, containers, and tmux session.

## Cache Flow

```
mono init                          mono destroy / mono sync
    │                                      │
    ▼                                      ▼
┌──────────┐  miss   ┌──────────┐    ┌──────────┐
│ Compute  │────────▶│  Build   │───▶│  Store   │
│ CacheKey │         │ Artifact │    │ to Cache │
└────┬─────┘         └──────────┘    └──────────┘
     │                                     │
     │ hit                                 │
     ▼                                     ▼
┌──────────┐                         ┌──────────┐
│ Restore  │◀────────────────────────│ Hardlink │
│ Hardlink │        next init        │   Back   │
└──────────┘                         └──────────┘
```

## Cache Key Derivation

```
┌─────────────────┐    ┌─────────────────┐
│   Lockfile      │    │  Tool Version   │
│  (Cargo.lock,   │ +  │ (rustc --version│
│ package-lock)   │    │  node --version)│
└────────┬────────┘    └────────┬────────┘
         │                      │
         └──────────┬───────────┘
                    ▼
              SHA256 hash
                    │
                    ▼
         ┌──────────────────┐
         │ 16-char CacheKey │
         └──────────────────┘
```
